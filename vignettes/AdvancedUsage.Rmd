---
title: "Advanced motif and sequence manipulation"
shorttitle: "Advanced usage"
author:
- name: Benjamin Tremblay
  affiliation: University of Waterloo, Waterloo, Canada
  email: b2tremblay@uwaterloo.ca
abstract: >
  Introducing sequence motif types.
bibliography: universalmotif.bib
vignette: >
  %\VignetteIndexEntry{Advanced motif and sequence manipulation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
output:
  BiocStyle::html_document
---

```{r setup, echo=FALSE}
knitr::opts_chunk$set(collapse=TRUE, comment = "#>")
library(universalmotif)
library(Biostrings)
library(MotifDb)
```

## Multi-letter information

Though PCM/PPM/PWM/ICM type motifs are still widely used today, a few 'next
generation' motif formats have been proposed. These wish to add another layer
of information to motifs: nucleotide interdependence. To illustrate this,
consider the following sequences:

 # | Sequence
-- | --------
 1 | CAAAACC
 2 | CAAAACC
 3 | CAAAACC
 4 | CTTTTCC
 5 | CTTTTCC
 6 | CTTTTCC
: (\#tab:seqs2) Example sequences.

This becomes the following PPM:

Position |   1 |   2 |   3 |   4 |   5 |   6 |   7
-------- | --- | --- | --- | --- | --- | --- | ---
       A | 0.0 | 0.5 | 0.5 | 0.5 | 0.5 | 0.0 | 0.0
       C | 1.0 | 0.0 | 0.0 | 0.0 | 0.0 | 1.0 | 1.0
       G | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 | 0.0
       T | 0.0 | 0.5 | 0.5 | 0.5 | 0.5 | 0.0 | 0.0
: (\#tab:ppm2) Position probability matrix.

Based on the PPM representation, all three of CAAAACC, CTTTTCC, and CTATACC are
equally likely. Though looking at the starting sequences, should CTATACC really
be considered so? For transcription factor binding sites, generally the
answer is no. By incorporating this type of information into the motif,
this can allow for increased accuracy in motif searching. A few implementations
of this include: TFFM by @tffm, BaMM by @bamm, and KSM by @ksm.

The `r Biocpkg("universalmotif")` package implements its' own, much simplified,
version of this concept. Plainly, the standard PPM has been extended to include
k-letter frequencies, with k being any number higher than 1. For example, the
2-letter version of the table \@ref(tab:ppm2) motif would be:

Position |   1 |   2 |   3 |   4 |   5 |   6 
-------- | --- | --- | --- | --- | --- | --- 
      AA | 0.0 | 0.5 | 0.5 | 0.5 | 0.0 | 0.0
      AC | 0.0 | 0.0 | 0.0 | 0.0 | 0.5 | 0.0
      AG | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 | 0.0
      AT | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 | 0.0
      CA | 0.5 | 0.0 | 0.0 | 0.0 | 0.0 | 0.0
      CC | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 | 1.0
      CG | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 | 0.0
      CT | 0.5 | 0.0 | 0.0 | 0.0 | 0.0 | 0.0
      GA | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 | 0.0
      GC | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 | 0.0
      GG | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 | 0.0
      GT | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 | 0.0
      TA | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 | 0.0
      TC | 0.0 | 0.0 | 0.0 | 0.0 | 0.5 | 0.0
      TG | 0.0 | 0.0 | 0.0 | 0.0 | 0.0 | 0.0
      TT | 0.0 | 0.5 | 0.5 | 0.5 | 0.0 | 0.0
: (\#tab:multi) 2-letter probability matrix.

This format shows the probability of each letter combined with the probability
of the letter in the next position. The seventh column has been dropped, since
it is not needed; the information in the sixth column is sufficient, and there
is no eighth position to draw 2-letter probabilities from.
Now, the probability of getting CTATACC is no longer equal to CTTTTCC and
CAAAACC. This information is kept in the `multifreq` slot of `universalmotif`
class motifs. To add this information, use the `add_multifreq` function.

```{r}
motif <- create_motif("CWWWWCC", nsites = 6)  ## -> see next section
sequences <- Biostrings::DNAStringSet(rep(c("CAAAACC", "CTTTTCC"), 3))
motif.k2 <- add_multifreq(motif, sequences, add.k = 2)
motif.k2
```

## Motif trees with ggtree

Additionally, this package introduces the `motif_tree` function for generating
basic tree-like diagrams for comparing motifs.

```{r}
# library(MotifDb)

## motif_tree is much simpler, but also much faster and allows for
## bigger trees; done via the ggtree package
motif_tree(MotifDb[301:400], layout = "daylight", linecol = "family")
```

# Session info {.unnumbered}

```{r sessionInfo, echo=FALSE}
sessionInfo()
```

# References {.unnumbered}
